Bluepill.application("monit", :log_file => "<%= node['monit']['log_dir'] %>/bluepill-monit.log") do |app|
  app.process("monit") do |process|
    process.pid_file           = "<%= node['monit']['pid_dir'] %>"
    process.working_dir        = "<%= <br/> %>"
    process.start_command      = "#{node['runit']['sv_bin']} start #{node['runit']['service_dir']}/monit"
    process.stop_command       = "#{node['runit']['sv_bin']} stop #{node['runit']['service_dir']}/monit"
    process.restart_command    = "#{node['runit']['sv_bin']} hup #{node['runit']['service_dir']}/monit"
    process.daemonize          = true
    process.stdout             = process.stderr = "<%= node['monit']['log_dir'] %>/monit.log"

    process.monitor_children do |child_process|
      child_process.stop_command = "kill -QUIT {{PID}}"
    end
  end
end

